name: CI - Develop

on:
    push:
        branches:
            - release
            - main
            - develop
    pull_request:
        types: [synchronize]
    workflow_dispatch:

env:
    NODE_VERSION: 16.19.0
    FE_NEXTJS_PROJECT_ROOT: frontend/portfolio-website

jobs:
    prepare:
        name: Prepare
        runs-on: ubuntu-latest
        steps:
            - name: "üì•  Checkout repository"
              uses: actions/checkout@v3
              with:
                  fetch-depth: 0

            - name: "üîç  Verify Changed Files"
              uses: tj-actions/changed-files@v35
              id: changed-frontend-portfolio-website-files
              with:
                  files: ${{ env.FE_NEXTJS_PROJECT_ROOT }}/**/*

            - name: "üîÑ  Cache node_modules"
              uses: actions/cache@v2
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                  restore-keys: ${{ runner.os }}-node-

            - name: "üîß  Setup NodeJS ${{ env.NODE_VERSION }}"
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ env.NODE_VERSION }}

            - name: "üîß  Install npm@latest & CI Deps"
              run: |
                  npm i -g npm@latest
                  npm ci

    code-scanning:
        name: "üîç Code Scanning"
        runs-on: ubuntu-latest
        needs: prepare
        permissions:
            actions: read
            contents: read
            security-events: write
        strategy:
            fail-fast: false
            matrix:
                language: ["javascript"]
        steps:
            - name: "Check code scanning"
              run: |
                  echo \"Error: no code scanning checks implemented\"
            # - name: "üöÄ Initialize CodeQL"
            #   uses: github/codeql-action/init@v2
            #   with:
            #       languages: ${{ matrix.language }}
            # - name: "üì•  Checkout repository"
            #   uses: actions/checkout@v3
            #   with:
            #       fetch-depth: 0

            # - name: "üèóÔ∏è  Autobuild"
            #   uses: github/codeql-action/autobuild@v2
            # - name: Perform CodeQL Analysis
            #   uses: github/codeql-action/analyze@v2

    formatting:
        name: Formatting
        needs: code-scanning
        runs-on: ubuntu-latest
        steps:
            - name: "Check code formatting"
              run: |
                  echo \"Error: no format check specified\"

    linting:
        name: Linting
        needs: code-scanning
        runs-on: ubuntu-latest
        steps:
            - name: "Check code linting"
              run: |
                  echo \"Error: no lint specified\"

    unit-tests:
        name: Unit Tests
        needs: [linting, formatting]
        runs-on: ubuntu-latest
        steps:
            - name: "Run unit tests"
              run: |
                  echo \"Error: no unit-test specified\"

    integration-tests:
        name: Integration Tests
        needs: [linting, formatting]
        runs-on: ubuntu-latest
        steps:
            - name: "Run integration tests"
              run: |
                  echo \"Error: no integration-test specified\"
