---
name: CI Develop

on:
    push:
        branches-ignore:
            - release
            - main
            - develop

    pull_request:
        types: [synchronize]

    workflow_dispatch:

jobs:
    formatting:
        name: Formatting
        runs-on: ubuntu-latest
        env:
            NODE_VERSION: 16.19.0
        steps:
            - name: "游닌  Checkout repository"
              uses: actions/checkout@v3

            - name: "游댌  Verify Changed Files"
              uses: tj-actions/changed-files@v35
              id: changed-frontend-portfolio-website-files
              with:
                  files: ${{ env.FE_NEXTJS_PROJECT_ROOT }}/**/*

            - name: "游댃  Cache node_modules"
              if: ${{ always() }}
              uses: actions/cache@v2
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                  restore-keys: ${{ runner.os }}-node-

            - name: "游댢  Setup NodeJS ${{ env.NODE_VERSION }}"
              if: ${{ always() }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ env.NODE_VERSION }}

            - name: "游댢  Install npm@latest & CI Deps"
              if: ${{ always() }}
              run: |
                  npm i -g npm@latest
                  npm ci
    linting:
        name: Linting
        needs: formatting
        runs-on: ubuntu-latest
        env:
            NODE_VERSION: 16.19.0
        steps:
            - name: "游닌  Checkout repository"
              uses: actions/checkout@v3

            - name: "游댌  Verify Changed Files"
              uses: tj-actions/changed-files@v35
              id: changed-frontend-portfolio-website-files
              with:
                  files: ${{ env.FE_NEXTJS_PROJECT_ROOT }}/**/*

            - name: "游댃  Cache node_modules"
              if: ${{ always() }}
              uses: actions/cache@v2
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                  restore-keys: ${{ runner.os }}-node-

            - name: "游댢  Setup NodeJS ${{ env.NODE_VERSION }}"
              if: ${{ always() }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ env.NODE_VERSION }}

            - name: "游댢  Install npm@latest & CI Deps"
              if: ${{ always() }}
              run: |
                  npm i -g npm@latest
                  npm ci
    unit-tests:
        name: Unit Tests
        needs: linting
        runs-on: ubuntu-latest
        env:
            NODE_VERSION: 16.19.0
        steps:
            - name: "游닌  Checkout repository"
              uses: actions/checkout@v3

            - name: "游댌  Verify Changed Files"
              uses: tj-actions/changed-files@v35
              id: changed-frontend-portfolio-website-files
              with:
                  files: ${{ env.FE_NEXTJS_PROJECT_ROOT }}/**/*

            - name: "游댃  Cache node_modules"
              if: ${{ always() }}
              uses: actions/cache@v2
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                  restore-keys: ${{ runner.os }}-node-

            - name: "游댢  Setup NodeJS ${{ env.NODE_VERSION }}"
              if: ${{ always() }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ env.NODE_VERSION }}

            - name: "游댢  Install npm@latest & CI Deps"
              if: ${{ always() }}
              run: |
                  npm i -g npm@latest
                  npm ci
    integration-tests:
        name: Integration Tests
        needs: linting
        runs-on: ubuntu-latest
        env:
            NODE_VERSION: 16.19.0
        steps:
            - name: "游닌  Checkout repository"
              uses: actions/checkout@v3

            - name: "游댌  Verify Changed Files"
              uses: tj-actions/changed-files@v35
              id: changed-frontend-portfolio-website-files
              with:
                  files: ${{ env.FE_NEXTJS_PROJECT_ROOT }}/**/*

            - name: "游댃  Cache node_modules"
              if: ${{ always() }}
              uses: actions/cache@v2
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                  restore-keys: ${{ runner.os }}-node-

            - name: "游댢  Setup NodeJS ${{ env.NODE_VERSION }}"
              if: ${{ always() }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ env.NODE_VERSION }}

            - name: "游댢  Install npm@latest & CI Deps"
              if: ${{ always() }}
              run: |
                  npm i -g npm@latest
                  npm ci
    build:
        name: Build
        needs: [integration-tests, unit-tests]
        runs-on: ubuntu-latest
        env:
            NODE_VERSION: 16.19.0
        steps:
            - name: "游닌  Checkout repository"
              uses: actions/checkout@v3

            - name: "游댌  Verify Changed Files"
              uses: tj-actions/changed-files@v35
              id: changed-frontend-portfolio-website-files
              with:
                  files: ${{ env.FE_NEXTJS_PROJECT_ROOT }}/**/*

            - name: "游댃  Cache node_modules"
              if: ${{ always() }}
              uses: actions/cache@v2
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                  restore-keys: ${{ runner.os }}-node-

            - name: "游댢  Setup NodeJS ${{ env.NODE_VERSION }}"
              if: ${{ always() }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ env.NODE_VERSION }}

            - name: "游댢  Install npm@latest & CI Deps"
              if: ${{ always() }}
              run: |
                  npm i -g npm@latest
                  npm ci

    package:
      name: Package
      needs: build
      runs-on: ubuntu-latest
      env:
          NODE_VERSION: 16.19.0
      steps:
          - name: "游닌  Checkout repository"
            uses: actions/checkout@v3

          - name: "游댌  Verify Changed Files"
            uses: tj-actions/changed-files@v35
            id: changed-frontend-portfolio-website-files
            with:
                files: ${{ env.FE_NEXTJS_PROJECT_ROOT }}/**/*

          - name: "游댃  Cache node_modules"
            if: ${{ always() }}
            uses: actions/cache@v2
            with:
                path: ~/.npm
                key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                restore-keys: ${{ runner.os }}-node-

          - name: "游댢  Setup NodeJS ${{ env.NODE_VERSION }}"
            if: ${{ always() }}
            uses: actions/setup-node@v1
            with:
                node-version: ${{ env.NODE_VERSION }}

          - name: "游댢  Install npm@latest & CI Deps"
            if: ${{ always() }}
            run: |
                npm i -g npm@latest
                npm ci